"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _get(e,t,i){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=_superPropBase(e,t);if(n){var s=Object.getOwnPropertyDescriptor(n,t);return s.get?s.get.call(i):s.value}})(e,t,i||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(n){return function(){var e,t=_getPrototypeOf(n);if(_isNativeReflectConstruct()){var i=_getPrototypeOf(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return _possibleConstructorReturn(this,e)}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}window.Me||(window.Me={}),window.Me.skinType||(Me.skinTypes=[]);var SkinField=function(){function t(e){_classCallCheck(this,t),this.field=e.field,this.ID=this.field.getAttribute("id"),this.name=this.field.getAttribute("name"),this.type=this.field.hasAttribute("type")?this.field.getAttribute("type"):this.field.tagName.toLowerCase(),this.label=this.field.parentElement.querySelector('label[for="'+this.ID+'"]')?this.field.parentElement.querySelector('label[for="'+this.ID+'"]'):null,this.customSkin=this.field.parentElement.querySelector('[me\\:skin\\:id="'.concat(this.ID,'"]'))?this.field.parentElement.querySelector('[me\\:skin\\:id="'.concat(this.ID,'"]')):null,this.dependenciesExist()&&this.requirementsExist()&&(this.options={debug:!(!window.SETTINGS||!SETTINGS.DEBUG_MODE)&&SETTINGS.DEBUG_MODE})}return _createClass(t,[{key:"initialize",value:function(){this.setDOMAttr(),this.setCustomVariables(),this.customSkin&&(this.addCommonEvents(),this.removeCustomEvents(),this.addCustomEvents(),this.setInitialValue())}},{key:"addCommonEvents",value:function(){this.customSkin.addEventListener("mouseenter",this.toggleHover.bind(this)),this.customSkin.addEventListener("mouseleave",this.toggleHover.bind(this)),this.customSkin.addEventListener("keydown",this.keyHandler.bind(this))}},{key:"removeCommonEvents",value:function(){this.customSkin.removeEventListener("mouseenter",this.toggleHover.bind(this)),this.customSkin.removeEventListener("mouseleave",this.toggleHover.bind(this)),this.customSkin.removeEventListener("keydown",this.keyHandler.bind(this))}},{key:"setDOMAttr",value:function(){this.field.setAttribute("me:skin:render","true"),this.field.setAttribute("me:skin:type",this.type),this.customSkin.setAttribute("me:skin:render","true"),this.customSkin.setAttribute("me:skin:disabled",this.field.disabled),this.field.disabled||this.customSkin.setAttribute("tabindex",0)}},{key:"dependenciesExist",value:function(){return!0}},{key:"requirementsExist",value:function(){var e=!0;return this.customSkin||(console.error("Skin element associated with ID:".concat(this.ID," can't be found. Add me:skin:id=\"").concat(this.ID,'"')),e=!1),this.ID||(console.error("ID attribute must be defined on the native field"),e=!1),e}},{key:"toggleHover",value:function(){this.field.hasAttribute("disabled")&&this.field.getAttribute("disabled")||this.customSkin.classList.toggle("hover")}},{key:"setCustomVariables",value:function(){}},{key:"addCustomEvents",value:function(){}},{key:"removeCustomEvents",value:function(){}},{key:"setInitialValue",value:function(){}},{key:"keyHandler",value:function(){}},{key:"name",get:function(){return this._name},set:function(e){"string"==typeof e?e&&(this._name=e):console.error("The name parameter must be a string")}},{key:"type",get:function(){return this._type},set:function(e){"string"==typeof e?e&&(this._type=e):console.error("The type parameter must be a string")}},{key:"ID",get:function(){return this._ID},set:function(e){"string"==typeof e?e&&(this._ID=e):console.error("The ID parameter must be a string")}},{key:"options",get:function(){return this._options},set:function(e){this._options=e}},{key:"disabled",get:function(){return this._disabled},set:function(e){"boolean"==typeof e?(this.field.setAttribute("disabled",e),this._disabled=e,this.customSkin&&(this.customSkin.setAttribute("me:skin:disabled",e),!0===e?this.customSkin.setAttribute("tabindex",-1):this.customSkin.setAttribute("tabindex",0))):console.error("The bool parameter must be a boolean")}}]),t}(),SkinSelect=function(){_inherits(s,SkinField);var i=_createSuper(s);function s(e){var t;return _classCallCheck(this,s),(t=i.call(this,e)).preventDefaultChangeEvent=t.field.hasAttribute("me:skin:prevent-default"),t.skinChoicesWrapper=t.field.parentNode.querySelector('[me\\:skin\\:choices="'.concat(t.ID,'"]')),t.choiceSelected=t.skinChoicesWrapper.querySelector(".choice[selected]"),t.isAnimating=!1,t.classes={opening:"is-opening",closing:"is-closing",open:"is-open",native:"is-native"},t}return _createClass(s,[{key:"initialize",value:function(){_get(_getPrototypeOf(s.prototype),"initialize",this).call(this),this.setDefault()}},{key:"setDefault",value:function(){this.defaults&&this.skinChoicesWrapper.querySelectorAll(".choice")[Array.from(this.defaults.parentNode.children).indexOf(this.defaults)].setAttribute("default",!0)}},{key:"setInitialValue",value:function(){this.selected?this.setSelection(Array.from(this.selected.parentNode.children).indexOf(this.selected),this.preventDefaultChangeEvent):this.setSelection(0,this.preventDefaultChangeEvent)}},{key:"setDOMAttr",value:function(){_get(_getPrototypeOf(s.prototype),"setDOMAttr",this).call(this),this.field.parentNode.setAttribute("me:skin:wrapper",this.ID),this.field.removeAttribute("me:skin:type"),this.field.parentNode.setAttribute("me:skin:type",this.type),this.skinChoicesWrapper.querySelectorAll(".choice").forEach(function(e,t){e.setAttribute("tabindex",-1)}),this.field.setAttribute("tabindex",-1)}},{key:"setCustomVariables",value:function(){this.customSkin&&(this.defaults=this.field.querySelector("option[default]"),this.selected=this.field.querySelector("option[selected]"),this.selection=this.field.parentNode.querySelector('[me\\:skin\\:selection="'.concat(this.ID,'"]')),this.wrapper=this.field.parentNode),(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/iPhone|iPad|iPod/i)||navigator.userAgent.match(/Opera Mini/i)||navigator.userAgent.match(/IEMobile/i))&&this.field.addClass(this.classes.native),this.isNative=this.field.classList.contains(this.classes.native)}},{key:"addEventWhenOpen",value:function(){var i=this;document.addEventListener("click",this.close.bind(this)),this.skinChoicesWrapper.querySelectorAll(".choice").forEach(function(e,t){e.addEventListener("keydown",i.keydownOnChoice.bind(i)),e.addEventListener("click",i.handleSelection.bind(i))})}},{key:"keydownOnChoice",value:function(e){13===e.keyCode&&this.handleSelection(e),9===e.keyCode&&this.close()}},{key:"removeEventOnClose",value:function(){var i=this;document.removeEventListener("click",this.close.bind(this)),this.skinChoicesWrapper.querySelectorAll(".choice").forEach(function(e,t){e.removeEventListener("keydown",i.keydownOnChoice.bind(i)),e.removeEventListener("click",i.handleSelection.bind(i))})}},{key:"addCustomEvents",value:function(){var e=this;window.addEventListener("resize",function(){e.isOpen&&e.close()}),this.field.addEventListener("change",this.handleChange.bind(this)),this.isNative||(this.customSkin.addEventListener("click",this.handleState.bind(this)),this.label&&this.label.addEventListener("click",this.handleState.bind(this)))}},{key:"removeCustomEvents",value:function(){var e=this;window.removeEventListener("resize",function(){e.isOpen&&e.close()}),this.field.removeEventListener("change",this.handleChange.bind(this)),this.isNative||(this.customSkin.removeEventListener("click",this.handleState.bind(this)),this.label&&this.label.removeEventListener("click",this.handleState.bind(this)))}},{key:"handleChange",value:function(){var i=this;this.choiceSelected=this.skinChoicesWrapper.querySelectorAll(".choice")[this.getSelectedIndex()],this.skinChoicesWrapper.querySelectorAll(".choice").forEach(function(e,t){e.setAttribute("selected",!1),t===i.getSelectedIndex()&&e.setAttribute("selected",!0)}),this.updateHtml(),this.isOpen&&this.close()}},{key:"handleState",value:function(e){this.field.disabled||(e.preventDefault(),this.isOpen?this.close():this.open())}},{key:"open",value:function(){this.field.disabled||this.isAnimating||(document.querySelectorAll("select:not("+this.field.getAttribute("name")+")").forEach(function(e,t){var i=Me.skin.getField(e);i&&i.close()}),this.isAnimating=!0,this.skinChoicesWrapper.style.height=this.choicesHeight(),this.wrapper.classList.add(this.classes.opening),this.wrapper.addEventListener("transitionend",this.handleEndOpenTransition.bind(this)),this.addEventWhenOpen())}},{key:"close",value:function(e){this.field.disabled||this.isAnimating||(e&&e.preventDefault(),this.isOpen&&(this.isAnimating=!0),this.skinChoicesWrapper.style.height="0px",this.wrapper.classList.add(this.classes.closing),this.wrapper.addEventListener("transitionend",this.handleEndCloseTransition.bind(this)),this.removeEventOnClose())}},{key:"handleEndOpenTransition",value:function(){this.wrapper.classList.add(this.classes.open),this.wrapper.classList.remove(this.classes.opening),this.wrapper.removeEventListener("transitionend",this.handleEndOpenTransition.bind(this)),this.isAnimating=!1,this.skinChoicesWrapper.querySelectorAll(".choice")[this.getSelectedIndex()].focus()}},{key:"handleEndCloseTransition",value:function(){this.wrapper.classList.remove("".concat(this.classes.open),"".concat(this.classes.closing)),this.wrapper.removeEventListener("transitionend",this.handleEndCloseTransition.bind(this)),this.isAnimating=!1}},{key:"handleSelection",value:function(e){e.preventDefault(),this.setSelection(Array.from(event.target.parentNode.children).indexOf(event.target))}},{key:"setSelection",value:function(e,t){var i=this,n=0<arguments.length&&void 0!==e?e:0,s=1<arguments.length?t:void 0;this.field.querySelectorAll("option").forEach(function(e,t){e.setAttribute("selected",!1),t===n&&(e.setAttribute("selected","selected"),i.field.value=e.getAttribute("value"),s?i.updateHtml():i.field.dispatchEvent(new Event("change")))})}},{key:"getSelectedIndex",value:function(){var e=this.field.querySelector('option[value="'+this.field.value+'"]');return Array.from(e.parentNode.children).indexOf(e)}},{key:"updateHtml",value:function(){this.selection.textContent=this.choiceSelected.textContent}},{key:"keyHandler",value:function(e){switch(_get(_getPrototypeOf(s.prototype),"keyHandler",this).call(this,e),e.keyCode){case 38:case 40:if(this.isOpen){var t=38===e.keyCode?-1:1,i=Array.from(this.customSkin.querySelector(":focus").parentNode.children).indexOf(this.customSkin.querySelector(":focus")),n=this.skinChoicesWrapper.querySelectorAll(".choice")[i+t];n&&n.focus()}else this.open();break;case 27:this.customSkin.focus(),this.close()}}},{key:"requirementsExist",value:function(){var e=_get(_getPrototypeOf(s.prototype),"requirementsExist",this).call(this);return document.querySelector('[me\\:skin\\:choices="'.concat(this.ID,'"]'))||console.error("Can't find the associated me:skin:choices attribute linked to field. See me:skin:choices in README.md"),document.querySelector('[me\\:skin\\:selection="'.concat(this.ID,'"]'))||console.error("Can't find the associated me:skin:selection attribute linked to field. See me:skin:selection in README.md"),e}},{key:"choicesHeight",value:function(){var i=0;return this.skinChoicesWrapper.querySelectorAll(".choice").forEach(function(e,t){i+=e.offsetHeight}),"".concat(i,"px")}},{key:"isOpen",get:function(){return this.wrapper.classList.contains(this.classes.open)}}]),s}();Me.skinTypes.SkinSelect=SkinSelect;var SkinManager=function(){function t(e){_classCallCheck(this,t),this.name="SkinManager",this.fields=[],this.options=e,this.newFields=[]}return _createClass(t,[{key:"initFields",value:function(e){var t=0<arguments.length&&void 0!==e?e:document.querySelector("html");this.clearFields();var i=t.querySelectorAll("[me\\:skin]");this.newFields=[];for(var n=0;n<i.length;n++)this.addField(i[n]);for(var s=0;s<this._newFields.length;s++)this.newFields[s].initialize()}},{key:"getField",value:function(e){for(var t in this.fields){var i=this.fields[t];if(i.ID===e.getAttribute("id"))return i}}},{key:"addField",value:function(e,t){var i=1<arguments.length&&void 0!==t&&t,n=e.getAttribute("me:skin"),s={field:e,type:n},o="Skin".concat(n.charAt(0).toUpperCase()).concat(n.slice(1));if("function"==typeof Me.skinTypes[o]){if(!e.getAttribute("me:skin:render")){var r=new Me.skinTypes[o](s);this.fields.push(r),this.newFields.push(r),i&&r.initialize()}}else console.error("The skin type ".concat(o," does not exist. Please select one listed in the following array"),Object.keys(Me.skinTypes))}},{key:"clearFields",value:function(){var e=[];for(var t in this.fields){var i=this.fields[t];"object"==_typeof(i)&&(document.body.contains(i.el)?e.push(i):i.terminate())}this.fields=e}},{key:"name",get:function(){return this._name},set:function(e){this._name=e}},{key:"options",set:function(e){this._options=e},get:function(){return this._options}},{key:"newFields",get:function(){return this._newFields},set:function(e){this._newFields=e}},{key:"fields",get:function(){return this._fields},set:function(e){this._fields=e}}]),t}();window.Me||(window.Me={}),Me.skin=new SkinManager,document.addEventListener("DOMContentLoaded",function(e){Me.skin.initFields()});